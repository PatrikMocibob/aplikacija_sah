<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Player Profile - Chess Bots Arena</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap");

      body {
        background: linear-gradient(to bottom right, #1b1d22, #0f1013);
        color: #f0e9db;
        font-family: "Playfair Display", serif;
        min-height: 100vh;
        padding-top: 2rem;
      }

      h1 {
        font-weight: 900;
        font-size: 3rem;
        letter-spacing: 0.1em;
        text-shadow: 0 0 10px #d4af37;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
      }

      h1 .bi-person-circle {
        color: #d4af37;
        font-size: 3.5rem;
        animation: pulse 3s ease-in-out infinite;
      }

      #username {
        text-align: center;
        font-size: 1.5rem;
        color: #d4af37;
        margin-bottom: 2rem;
      }

      @keyframes pulse {
        0%,
        100% {
          text-shadow: 0 0 10px #d4af37;
          transform: scale(1);
        }
        50% {
          text-shadow: 0 0 20px #ffd700;
          transform: scale(1.1);
        }
      }

      .table-container {
        max-width: 700px;
        margin: 0 auto;
        background-color: #2e2c31;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 0 15px #d4af37;
      }

      table {
        color: #f0e9db;
      }

      thead th {
        border-bottom: 2px solid #d4af37;
      }

      tbody tr:hover {
        background-color: #3e3c41;
      }

      .btn-back {
        display: block;
        margin: 2rem auto 0;
        max-width: 200px;
        font-weight: 700;
        border-radius: 1rem;
        box-shadow: 0 0 10px #d4af37;
        color: #d4af37;
        border: 2px solid #d4af37;
        background: transparent;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .btn-back:hover {
        background-color: #d4af37;
        color: #1b1d22;
      }
    </style>
  </head>
  <body>
    <main>
      <h1><i class="bi bi-person-circle"></i> Player Profile</h1>
      <p id="username">
        Username: <span id="userNameText">ChessMaster42</span>
      </p>
      <div class="table-container">
        <table class="table table-dark table-striped table-hover text-center">
          <thead>
            <tr>
              <th>Bot</th>
              <th>Games Played</th>
              <th>Wins</th>
              <th>Losses</th>
              <th>Draws</th>
              <th>Win Rate</th>
            </tr>
          </thead>
          <tbody id="statsTableBody">
            <!-- Stats rows inserted by JS -->
          </tbody>
        </table>
      </div>
      <button class="btn btn-outline-warning btn-back" id="backBtn">
        &larr; Back to Arena
      </button>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Get username from user object or fallback key
        const user = JSON.parse(localStorage.getItem("user"));
        const username =
          user?.name || localStorage.getItem("username") || "Guest";

        // Set username in profile UI
        document.getElementById("userNameText").textContent = username;

        // Load player stats from localStorage
        const statsKey = `stats_${username}`;
        const playerStats = JSON.parse(localStorage.getItem(statsKey)) || {};

        function calculateWinRate(stats) {
          if (stats.played === 0) return "0%";
          return ((stats.wins / stats.played) * 100).toFixed(1) + "%";
        }

        const tbody = document.getElementById("statsTableBody");

        // If player has no stats yet
        if (Object.keys(playerStats).length === 0) {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td colspan="6">No games played yet.</td>`;
          tbody.appendChild(tr);
        } else {
          // Loop through each bot and render stats
          Object.entries(playerStats).forEach(([bot, stats]) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
          <td>${bot}</td>
          <td>${stats.played}</td>
          <td>${stats.wins}</td>
          <td>${stats.losses}</td>
          <td>${stats.draws}</td>
          <td>${calculateWinRate(stats)}</td>
        `;
            tbody.appendChild(tr);
          });
        }

        // Back button handler
        document.getElementById("backBtn").addEventListener("click", () => {
          window.location.href = "loggedin.html";
        });
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const username = localStorage.getItem("username") || "Guest";
        document.getElementById("userNameText").textContent = username;
      });
    </script>
  </body>
</html>
